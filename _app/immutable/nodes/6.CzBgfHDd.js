import{s as tt,a as V,e as q,g as O,c as W,b as B,f as S,o as z,i as Y,h as G,S as N,r as et,K as st,n as at}from"../chunks/scheduler.ewBkyc9q.js";import{S as nt,i as it,b as x,e as ot,t as P,g as rt,c as L,a as Q,m as X,d as j}from"../chunks/index.DpmaPz1F.js";import{I as J,S as H,a as K,P as lt}from"../chunks/index.c5t111vt.js";function ct({pen:e},{radius:a,center:s,hsl:t}){e.lineCap="butt",e.lineWidth=1,e.strokeStyle=`hsla(${t}, 1)`,e.shadowColor=`hsla(${t}, 1)`,e.shadowBlur=10,e.beginPath(),e.arc(s.x,s.y,a,Math.PI,2*Math.PI),e.stroke(),e.shadowBlur=5,e.lineWidth=2,e.strokeStyle=`hsla(${t}, 0.3)`,e.shadowOffsetY=2.5,e.stroke(),e.strokeStyle=`hsla(${t}, 0.2)`,e.stroke(),e.strokeStyle=`hsla(${t}, 0.1)`,e.stroke(),e.shadowOffsetY=-2.5,e.stroke(),e.strokeStyle=`hsla(${t}, 0.2)`,e.stroke(),e.strokeStyle=`hsla(${t}, 0.3)`,e.stroke()}function ut(e,{arc:a,angle:s}){const t={x:a.center.x+Math.cos(s)*a.radius,y:a.center.y+Math.sin(s)*a.radius};e.beginPath(),e.arc(t.x,t.y,5,0,2*Math.PI),e.stroke(),e.stroke()}let g;function ht(e,{unisonWidth:a,durationSeconds:s}={unisonWidth:1,durationSeconds:1}){[-a,0,a].map(c=>{g||(g=new AudioContext);const n=g.createOscillator(),o=g.createGain();o.gain.value=.2,n.connect(o);const u=g.createGain();u.gain.cancelScheduledValues(g.currentTime),o.connect(u),n.type="sine",n.frequency.value=e,n.detune.value=c;const h={attack:0,decay:.05,sustain:{duration:0,intensity:.8},release:.4},y=g.currentTime,k=h.attack*s,d=y+k,b=h.decay*s;u.gain.setValueAtTime(0,y),u.gain.linearRampToValueAtTime(1,d),u.gain.setTargetAtTime(h.sustain.intensity,d,b);const r=d+b+h.sustain.duration*s,f=h.release*s;u.gain.setValueAtTime(h.sustain.intensity,r);const i=r+f;u.gain.linearRampToValueAtTime(0,i);const l=g.sampleRate/2,m=g.createBiquadFilter();return m.type="lowpass",m.frequency.value=.2*l,m.Q.value=23.1,u.connect(m),m.connect(g.destination),n}).forEach(c=>{c.start()})}function dt(e){let a,s;return a=new J({props:{src:e[1]?H:K,class:"absolute right-2 top-2 z-10 size-6 stroke-gray-400"}}),{c(){L(a.$$.fragment)},l(t){Q(a.$$.fragment,t)},m(t,c){X(a,t,c),s=!0},p(t,c){const n={};c&2&&(n.src=t[1]?H:K),a.$set(n)},i(t){s||(P(a.$$.fragment,t),s=!0)},o(t){x(a.$$.fragment,t),s=!1},d(t){j(a,t)}}}function ft(e){let a,s;return a=new J({props:{src:lt,class:" pointer-events-none absolute left-1/2 top-1/2 size-16 -translate-x-1/2 -translate-y-1/2 transform stroke-gray-300/80 stroke-2"}}),{c(){L(a.$$.fragment)},l(t){Q(a.$$.fragment,t)},m(t,c){X(a,t,c),s=!0},p:at,i(t){s||(P(a.$$.fragment,t),s=!0)},o(t){x(a.$$.fragment,t),s=!1},d(t){j(a,t)}}}function mt(e){let a,s,t,c,n,o,u,h,y;const k=[ft,dt],d=[];function b(r,f){return r[2]?1:0}return n=b(e),o=d[n]=k[n](e),{c(){a=V(),s=q("div"),t=q("canvas"),c=V(),o.c(),this.h()},l(r){a=O(r),s=W(r,"DIV",{class:!0});var f=B(s);t=W(f,"CANVAS",{class:!0}),B(t).forEach(S),c=O(f),o.l(f),f.forEach(S),this.h()},h(){z(t,"class","relative h-[80dvh] w-full bg-black"),z(s,"class","relative")},m(r,f){Y(r,a,f),Y(r,s,f),G(s,t),e[5](t),G(s,c),d[n].m(s,null),u=!0,h||(y=[N(document,"visibilitychange",e[4]),N(t,"click",e[3])],h=!0)},p(r,[f]){let i=n;n=b(r),n===i?d[n].p(r,f):(rt(),x(d[i],1,1,()=>{d[i]=null}),ot(),o=d[n],o?o.p(r,f):(o=d[n]=k[n](r),o.c()),P(o,1),o.m(s,null))},i(r){u||(P(o),u=!0)},o(r){x(o),u=!1},d(r){r&&(S(a),S(s)),e[5](null),d[n].d(),h=!1,et(y)}}}function gt(e,a,s){let t,c=null,n,o=!0;const u=[261.63,277.18,293.66,311.13,329.63,349.23,369.99,392,415.3,440,466.16,493.88];let h=u.map((i,l,m)=>{const _=2*Math.PI*(50-2*l),w=15*60,$=_/w;return{color:`${l*(360/m.length)},100%, 50%`,tone:u[l],velocity:$,lastImpact:0,nextImpactTime:0}});const y=(i,l)=>i+Math.PI/l*1e3;let k=!1;function d({pen:i,paper:l}){n||(n=new Date().getTime(),h.forEach(v=>{v.lastImpact=v.nextImpactTime=n}));const m=new Date().getTime(),M=(m-n)/1e3;l.width=l.clientWidth,l.height=l.clientHeight;const _=[{x:l.width*.1,y:l.height*.9},{x:l.width*.9,y:l.height*.9}];i.strokeStyle="#FFFFFF66",i.lineWidth=2,i.lineCap="round",i.beginPath(),i.moveTo(_[0].x,_[0].y),i.lineTo(_[1].x,_[1].y),i.stroke();const w=_[1].x-_[0].x,$=.05*w,U=(w/2-$)/(h.length-1),F={x:l.width*.5,y:l.height*.9};h=h.map(({color:v,velocity:A,tone:D,lastImpact:C,nextImpactTime:T},Z)=>{const R=$+Z*U;ct({pen:i,paper:l},{radius:R,center:F,hsl:v}),i.lineWidth=2,i.strokeStyle=`hsla(${v}, 1)`,i.shadowBlur=8,i.shadowOffsetY=0;const E=2*Math.PI,I=(Math.PI+M*A)%E,p=I>=Math.PI?I:E-I;return ut(i,{arc:{radius:R,center:F},angle:p}),m>T&&(o&&ht(D),C=T,T=y(C,A)),{color:v,tone:D,nextImpactTime:T,lastImpact:C,velocity:A}}),requestAnimationFrame(()=>d({paper:l,pen:i}))}function b(){k?s(1,o=!o):(c=t.getContext("2d"),d({paper:t,pen:c}),s(2,k=!0))}const r=()=>{console.log("disabling sound"),s(1,o=!1)};function f(i){st[i?"unshift":"push"](()=>{t=i,s(0,t)})}return[t,o,k,b,r,f]}class bt extends nt{constructor(a){super(),it(this,a,gt,mt,tt,{})}}export{bt as component};
