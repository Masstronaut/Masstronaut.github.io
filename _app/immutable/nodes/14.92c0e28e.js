import{s as W,a as B,f as j,c as H,g as L,h as Q,d as S,j as Y,i as F,F as N,A as I,G as z,o as J,p as K}from"../chunks/scheduler.7131e7f1.js";import{S as U,i as X}from"../chunks/index.9e889c2d.js";function Z({paper:l,pen:o},{radius:a,center:s}){o.beginPath(),o.arc(s.x,s.y,a,Math.PI,2*Math.PI),o.stroke()}let u;function $(l,{time:o,feedback:a,durationSeconds:s}){const c=l.createDelay();c.delayTime.value=o*s,c.connect(l.destination);const e=l.createGain();return e.gain.value=a,c.connect(e),e.connect(c),c}function p(l,{unisonWidth:o,durationSeconds:a}={unisonWidth:10,durationSeconds:1}){[-o,0,o].map(c=>{u||(u=new AudioContext);const e=u.createOscillator(),i=u.createGain();i.gain.cancelScheduledValues(u.currentTime),e.connect(i),e.type="sawtooth",e.frequency.value=l,e.detune.value=c;const h={attack:.1,decay:0,sustain:{duration:.8,intensity:.8},release:.15},m=u.currentTime,_=h.attack*a,g=m+_,T=h.decay*a;i.gain.setValueAtTime(0,m),i.gain.linearRampToValueAtTime(1,g),i.gain.setTargetAtTime(h.sustain.intensity,g,T);const w=g+T+h.sustain.duration*a,R=h.release*a,t=w+R;i.gain.setValueAtTime(h.sustain.intensity,w),i.gain.linearRampToValueAtTime(0,t);const n=u.sampleRate/2,r=u.createBiquadFilter();r.type="lowpass",r.frequency.value=.2*n,r.Q.value=23.1,i.connect(r);const y=$(u,{durationSeconds:.8,feedback:.4,time:.2});return r.connect(y),r.connect(u.destination),e}).forEach(c=>{c.start()})}function tt(l){let o,a,s,c;return{c(){o=B(),a=j("canvas"),this.h()},l(e){o=H(e),a=L(e,"CANVAS",{class:!0}),Q(a).forEach(S),this.h()},h(){Y(a,"class","h-[80dvh] w-full bg-black")},m(e,i){F(e,o,i),F(e,a,i),l[3](a),s||(c=[N(document,"visibilitychange",l[2]),N(a,"click",l[4])],s=!0)},p:I,i:I,o:I,d(e){e&&(S(o),S(a)),l[3](null),s=!1,z(c)}}}function et(l,o,a){let s,c=null,e,i=!0;const h=[261.63,277.18,293.66,311.13,329.63,349.23,369.99,392,415.3,440,466.16,493.88];let m=Array.from({length:12}).map((t,n)=>{const y=2*Math.PI*(50-2*n),d=15*60,v=y/d;return{color:`hsl(${n*30},100%, 50%)`,tone:h[n],velocity:v,lastImpact:0,nextImpactTime:0}});const _=(t,n)=>t+Math.PI/n*1e3;function g({pen:t,paper:n}){e||(e=new Date().getTime(),m.forEach(f=>{f.lastImpact=f.nextImpactTime=e}));const r=new Date().getTime(),y=(r-e)/1e3;n.width=n.clientWidth,n.height=n.clientHeight;const d=[{x:n.width*.1,y:n.height*.9},{x:n.width*.9,y:n.height*.9}];t.strokeStyle="white",t.lineWidth=5,t.lineCap="round",t.beginPath(),t.moveTo(d[0].x,d[0].y),t.lineTo(d[1].x,d[1].y),t.stroke();const v=d[1].x-d[0].x,D=.05*v,G=(v/2-D)/(m.length-1),k={x:n.width*.5,y:n.height*.9};m=m.map(({color:f,velocity:x,tone:E,lastImpact:b,nextImpactTime:A},O)=>{const P=D+O*G;t.lineWidth=3,t.strokeStyle=f,t.shadowColor=f,t.shadowBlur=10,t.shadowOffsetY=-1,Z({pen:t,paper:n},{radius:P,center:k}),t.fillStyle=f;const q=2*Math.PI,M=(Math.PI+y*x)%q,C=M>=Math.PI?M:q-M,V={x:k.x+Math.cos(C)*P,y:k.y+Math.sin(C)*P};return t.beginPath(),t.arc(V.x,V.y,5,0,2*Math.PI),t.fill(),r>A&&(i&&p(E),b=A,A=_(b,x)),{color:f,tone:E,nextImpactTime:A,lastImpact:b,velocity:x}}),requestAnimationFrame(()=>g({paper:n,pen:t}))}J(()=>{s&&(c=s.getContext("2d")),s&&c&&g({paper:s,pen:c})});const T=()=>a(1,i=!1);function w(t){K[t?"unshift":"push"](()=>{s=t,a(0,s)})}return[s,i,T,w,()=>a(1,i=!i)]}class st extends U{constructor(o){super(),X(this,o,et,tt,W,{})}}export{st as component};
