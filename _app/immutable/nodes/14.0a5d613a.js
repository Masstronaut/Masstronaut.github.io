import{s as tt,a as V,f as q,c as O,g as W,h as N,d as S,j as B,i as G,v as z,F as Y,G as et,p as at,A as st}from"../chunks/scheduler.7131e7f1.js";import{S as nt,i as ot,t as A,c as it,a as P,g as rt,b as L,d as Q,m as X,e as J}from"../chunks/index.9e889c2d.js";import{I as K,S as j,b as H,P as ct}from"../chunks/index.c66c71a1.js";function lt({paper:i,pen:t},{radius:a,center:e,hsl:s}){t.lineCap="butt",t.lineWidth=1,t.strokeStyle=`hsla(${s}, 1)`,t.shadowColor=`hsla(${s}, 1)`,t.shadowBlur=10,t.beginPath(),t.arc(e.x,e.y,a,Math.PI,2*Math.PI),t.stroke(),t.shadowBlur=5,t.lineWidth=2,t.strokeStyle=`hsla(${s}, 0.3)`,t.shadowOffsetY=2.5,t.stroke(),t.strokeStyle=`hsla(${s}, 0.2)`,t.stroke(),t.strokeStyle=`hsla(${s}, 0.1)`,t.stroke(),t.shadowOffsetY=-2.5,t.stroke(),t.strokeStyle=`hsla(${s}, 0.2)`,t.stroke(),t.strokeStyle=`hsla(${s}, 0.3)`,t.stroke()}function ut(i,{arc:t,angle:a}){const e={x:t.center.x+Math.cos(a)*t.radius,y:t.center.y+Math.sin(a)*t.radius};i.beginPath(),i.arc(e.x,e.y,5,0,2*Math.PI),i.stroke(),i.stroke()}let m;function ht(i,{time:t,feedback:a,durationSeconds:e}){const s=i.createDelay();s.delayTime.value=t*e,s.connect(i.destination);const n=i.createGain();return n.gain.value=a,s.connect(n),n.connect(s),s}function dt(i,{unisonWidth:t,durationSeconds:a}={unisonWidth:10,durationSeconds:1}){[-t,0,t].map(s=>{m||(m=new AudioContext);const n=m.createOscillator(),r=m.createGain();r.gain.value=.2,n.connect(r);const u=m.createGain();u.gain.cancelScheduledValues(m.currentTime),r.connect(u),n.type="sawtooth",n.frequency.value=i,n.detune.value=s;const h={attack:.1,decay:.05,sustain:{duration:.8,intensity:.8},release:.15},_=m.currentTime,k=h.attack*a,d=_+k,b=h.decay*a;u.gain.setValueAtTime(0,_),u.gain.linearRampToValueAtTime(1,d),u.gain.setTargetAtTime(h.sustain.intensity,d,b);const c=d+b+h.sustain.duration*a,f=h.release*a;u.gain.setValueAtTime(h.sustain.intensity,c);const o=c+f;u.gain.linearRampToValueAtTime(0,o);const l=m.sampleRate/2,g=m.createBiquadFilter();g.type="lowpass",g.frequency.value=.2*l,g.Q.value=23.1,u.connect(g);const w=ht(m,{durationSeconds:.8,feedback:.4,time:.2});return g.connect(w),g.connect(m.destination),n}).forEach(s=>{s.start()})}function ft(i){let t,a;return t=new K({props:{src:i[1]?j:H,class:"absolute right-2 top-2 z-10 size-6 stroke-gray-400"}}),{c(){L(t.$$.fragment)},l(e){Q(t.$$.fragment,e)},m(e,s){X(t,e,s),a=!0},p(e,s){const n={};s&2&&(n.src=e[1]?j:H),t.$set(n)},i(e){a||(P(t.$$.fragment,e),a=!0)},o(e){A(t.$$.fragment,e),a=!1},d(e){J(t,e)}}}function mt(i){let t,a;return t=new K({props:{src:ct,class:" pointer-events-none absolute left-1/2 top-1/2 size-16 -translate-x-1/2 -translate-y-1/2 transform stroke-gray-300/80 stroke-2"}}),{c(){L(t.$$.fragment)},l(e){Q(t.$$.fragment,e)},m(e,s){X(t,e,s),a=!0},p:st,i(e){a||(P(t.$$.fragment,e),a=!0)},o(e){A(t.$$.fragment,e),a=!1},d(e){J(t,e)}}}function gt(i){let t,a,e,s,n,r,u,h,_;const k=[mt,ft],d=[];function b(c,f){return c[2]?1:0}return n=b(i),r=d[n]=k[n](i),{c(){t=V(),a=q("div"),e=q("canvas"),s=V(),r.c(),this.h()},l(c){t=O(c),a=W(c,"DIV",{class:!0});var f=N(a);e=W(f,"CANVAS",{class:!0}),N(e).forEach(S),s=O(f),r.l(f),f.forEach(S),this.h()},h(){B(e,"class","relative h-[80dvh] w-full bg-black"),B(a,"class","relative")},m(c,f){G(c,t,f),G(c,a,f),z(a,e),i[5](e),z(a,s),d[n].m(a,null),u=!0,h||(_=[Y(document,"visibilitychange",i[4]),Y(e,"click",i[3])],h=!0)},p(c,[f]){let o=n;n=b(c),n===o?d[n].p(c,f):(rt(),A(d[o],1,1,()=>{d[o]=null}),it(),r=d[n],r?r.p(c,f):(r=d[n]=k[n](c),r.c()),P(r,1),r.m(a,null))},i(c){u||(P(r),u=!0)},o(c){A(r),u=!1},d(c){c&&(S(t),S(a)),i[5](null),d[n].d(),h=!1,et(_)}}}function kt(i,t,a){let e,s=null,n,r=!0;const u=[261.63,277.18,293.66,311.13,329.63,349.23,369.99,392,415.3,440,466.16,493.88];let h=Array.from({length:12}).map((o,l)=>{const w=2*Math.PI*(50-2*l),y=15*60,$=w/y;return{color:`${l*30},100%, 50%`,tone:u[l],velocity:$,lastImpact:0,nextImpactTime:0}});const _=(o,l)=>o+Math.PI/l*1e3;let k=!1;function d({pen:o,paper:l}){n||(n=new Date().getTime(),h.forEach(v=>{v.lastImpact=v.nextImpactTime=n}));const g=new Date().getTime(),w=(g-n)/1e3;l.width=l.clientWidth,l.height=l.clientHeight;const y=[{x:l.width*.1,y:l.height*.9},{x:l.width*.9,y:l.height*.9}];o.strokeStyle="#FFFFFF66",o.lineWidth=2,o.lineCap="round",o.beginPath(),o.moveTo(y[0].x,y[0].y),o.lineTo(y[1].x,y[1].y),o.stroke();const $=y[1].x-y[0].x,I=.05*$,U=($/2-I)/(h.length-1),M={x:l.width*.5,y:l.height*.9};h=h.map(({color:v,velocity:x,tone:D,lastImpact:C,nextImpactTime:T},Z)=>{const E=I+Z*U;lt({pen:o,paper:l},{radius:E,center:M,hsl:v}),o.lineWidth=2,o.strokeStyle=`hsla(${v}, 1)`,o.shadowBlur=8,o.shadowOffsetY=0;const R=2*Math.PI,F=(Math.PI+w*x)%R,p=F>=Math.PI?F:R-F;return ut(o,{arc:{radius:E,center:M},angle:p}),g>T&&(r&&dt(D),C=T,T=_(C,x)),{color:v,tone:D,nextImpactTime:T,lastImpact:C,velocity:x}}),requestAnimationFrame(()=>d({paper:l,pen:o}))}function b(){k?a(1,r=!r):(s=e.getContext("2d"),d({paper:e,pen:s}),a(2,k=!0))}const c=()=>a(1,r=!1);function f(o){at[o?"unshift":"push"](()=>{e=o,a(0,e)})}return[e,r,k,b,c,f]}class vt extends nt{constructor(t){super(),ot(this,t,kt,gt,tt,{})}}export{vt as component};
