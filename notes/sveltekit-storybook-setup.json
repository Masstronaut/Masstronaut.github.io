{"status":"seedling","statusIcon":"ðŸŒ±","title":"Setting up a SvelteKit project with Storybook","description":"Setting up Storybook on a SvelteKit project doesn't work out of the box using the config tool. This guide walks you through a few extra steps needed to get SvelteKit and Storybook running.","slug":"sveltekit-storybook-setup","publish":true,"lastmod":"2022-04-19T00:00:00.000Z","date":"2022-04-19T00:00:00.000Z","aliases":["Set up SvelteKit with Storybook","Sveltekit Storybook setup"],"tags":["status/seedling","topic/webdev","taxonomy/reference"],"timeToRead":3,"internalLinks":[],"flashcards":[],"html":"<p>This will walk you through the steps to set up a new <em>SvelteKit</em> project with <em>StorybookJS</em>. It will also configure Storybook to use <em>ViteJS</em>. Using Vite gets the local storybook server up and running around ~50x faster.</p>\n<blockquote><p>Note: Iâ€™ve opted to use TypeScript in this guide, but it works just as well for JavaScript. As of April 2022, Storybook supports svelte components implemented in TS, but does <strong>not</strong> support <em>stories</em> written in TypeScript yet.</p></blockquote>\n<p>Initialize a <em>SvelteKit</em> project:</p>\n<pre class=\"language-bash\"><!-- HTML_TAG_START --><code class=\"language-bash\"><span class=\"token function\">npm</span> init svelte@next my-sveltekit-app</code><!-- HTML_TAG_END --></pre>\n<p>Confirm that it can install <code>create-svelte@next</code> then continue to the SvelteKit config options. My preferred config is as follows:</p>\n<table><thead><tr><th>Option</th>\n<th>Selection</th></tr></thead>\n<tbody><tr><td>Which Svelte app template?</td>\n<td>Skeleton project</td></tr>\n<tr><td>Add type checking?</td>\n<td>TypeScript</td></tr>\n<tr><td>Add ESLint for code linting?</td>\n<td>Yes</td></tr>\n<tr><td>Add Prettier for code formatting?</td>\n<td>Yes</td></tr>\n<tr><td>Add Playwright for browser testing?</td>\n<td>No</td></tr></tbody></table>\n<p>With <em>SvelteKit</em> configured, we can start setting up <em>StorybookJS</em>:</p>\n<pre class=\"language-bash\"><!-- HTML_TAG_START --><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> my-sveltekit-app\nnpx sb init --builder @storybook/builder-vite</code><!-- HTML_TAG_END --></pre>\n<p>The automated <em>StorybookJS</em> configuration tool will run and set things up for a Svelte project. Itâ€™ll ask you if you want to set up the storybook linter plugin:</p>\n<table><thead><tr><th>Option</th>\n<th>Selection</th></tr></thead>\n<tbody><tr><td>Do you want to run the â€˜eslintPluginâ€™ fix on your project?</td>\n<td>Yes</td></tr></tbody></table>\n<p>Once the setup is done, there are a couple manual config steps we need to go through.</p>\n<p>First we need to tell Storybook to use <em>CommonJS</em>. Create the file <code>.storybook/package.json</code> and add the following to it:</p>\n<pre class=\"language-json\"><!-- HTML_TAG_START --><code class=\"language-json\"><span class=\"token comment\">// .storybook/package.json</span>\n<span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"commonjs\"</span>\n<span class=\"token punctuation\">&#125;</span></code><!-- HTML_TAG_END --></pre>\n<p>Then we need to remove Storybookâ€™s preprocessing config and tell <em>ViteJS</em> how to find and preprocess our svelte files:</p>\n<ol><li>Remove <code>&quot;preprocess&quot;: require(&quot;../svelte.config.js&quot;).preprocess</code></li>\n<li>Import the svelte preprocessor: <code>const preprocess = require(&#39;svelte-preprocess&#39;);</code></li>\n<li>Import the <code>path</code> package to help with include paths: <code>const path = require(&#39;path&#39;);</code></li>\n<li>Set the <em>ViteJS</em> config to use the svelte preprocessor and include paths (see the <code>async viteFinal(config, {configType}) {...}</code> below)</li></ol>\n<p>The final <code>.storybook/main.js</code> file should look like this:</p>\n<pre class=\"language-js\"><!-- HTML_TAG_START --><code class=\"language-js\"><span class=\"token comment\">// .storybook/main.js</span>\n<span class=\"token keyword\">const</span> preprocess <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'svelte-preprocess'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token string-property property\">\"stories\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"../src/**/*.stories.mdx\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"../src/**/*.stories.@(js|jsx|ts|tsx|svelte)\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"addons\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"@storybook/addon-links\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"@storybook/addon-essentials\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"@storybook/addon-svelte-csf\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"framework\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"@storybook/svelte\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"core\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token string-property property\">\"builder\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"@storybook/builder-vite\"</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">viteFinal</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> configType <span class=\"token punctuation\">&#125;</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    config<span class=\"token punctuation\">.</span>preprocess <span class=\"token operator\">=</span> <span class=\"token function\">preprocess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    config<span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">.</span>alias <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n\t  <span class=\"token comment\">// alias: path</span>\n\t  <span class=\"token literal-property property\">$components</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/components'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t  <span class=\"token literal-property property\">$routes</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/routes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t  <span class=\"token literal-property property\">$lib</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/lib'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t  <span class=\"token comment\">// The $styles alias is used to setup tailwindcss </span>\n\t  <span class=\"token literal-property property\">$styles</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/styles'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> config<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span></code><!-- HTML_TAG_END --></pre>\n<blockquote><p>Note: if you have different include path aliases, youâ€™ll want to make sure that the ones in <code>.storybook/main.js</code> match your <code>svelte.config.js</code> and <code>tsconfig.json</code> aliases</p></blockquote>\n<p>Voila! You should be all set. </p>\n<h2 id=\"bonus-tailwindcss-support\"><a href=\"#bonus-tailwindcss-support\" aria-hidden=\"true\" tabindex=\"-1\"><span class=\"icon icon-link\"></span></a>Bonus: Tailwindcss support</h2>\n<p>If you <em>also</em> want to use <em>tailwindcss</em> with both <em>SvelteJS</em>/<em>SvelteKit</em> and <em>StorybookJS</em>, that config has a couple of gotchas as well. Hereâ€™s the steps to get it up and running.</p>\n<p>First, install <em>tailwindcss</em> in your <em>SvelteKit</em> project (per <a href=\"https://tailwindcss.com/docs/guides/sveltekit\" rel=\"nofollow\">the official tailwind docs</a>):</p>\n<pre class=\"language-zsh\"><!-- HTML_TAG_START --><code class=\"language-zsh\">npm install -D tailwindcss postcss autoprefixer\nnpx tailwindcss init tailwind.config.cjs -p\nmv postcss.config.js postcss.config.cjs</code><!-- HTML_TAG_END --></pre>\n<p>Then update the <code>tailwind.config.cjs</code> so it knows where to find your components:</p>\n<pre class=\"language-js\"><!-- HTML_TAG_START --><code class=\"language-js\"><span class=\"token comment\">// tailwind.config.cjs</span>\n<span class=\"token comment\">/** @type &#123;import('tailwindcss').Config&#125; */</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'./src/**/*.&#123;html,js,svelte,ts&#125;'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">theme</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token literal-property property\">extend</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></code><!-- HTML_TAG_END --></pre>\n<p>Create a <code>src/styles/tailwind.css</code> file that sets up <em>tailwindcss</em> for your components:</p>\n<pre class=\"language-css\"><!-- HTML_TAG_START --><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@tailwind</span> base<span class=\"token punctuation\">;</span></span>\n<span class=\"token atrule\"><span class=\"token rule\">@tailwind</span> components<span class=\"token punctuation\">;</span></span>\n<span class=\"token atrule\"><span class=\"token rule\">@tailwind</span> utilities<span class=\"token punctuation\">;</span></span></code><!-- HTML_TAG_END --></pre>\n<p>Finally, create a <code>src/routes/__layout.svelte</code> file that includes <em>tailwindcss</em> for your sveltekit project:</p>\n<pre class=\"language-svelte\"><!-- HTML_TAG_START --><code class=\"language-svelte\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token string\">\"$styles/tailwind.css\"</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token punctuation\">/></span></span></code><!-- HTML_TAG_END --></pre>\n<p>At this point <em>tailwindcss</em> should be working in your <em>SvelteKit</em> project. It wonâ€™t be working in the <em>StorybookJS</em> view of your components though; storybook still needs to be configured to use <em>tailwindcss</em>. To do that add the following line to the top of <code>.storybook/preview.js</code>:</p>\n<pre class=\"language-js\"><!-- HTML_TAG_START --><code class=\"language-js\"><span class=\"token comment\">// .storybook/preview.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'$styles/tailwind.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// No need to touch the rest of it, which for me looks like this:</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> parameters <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token literal-property property\">actions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">argTypesRegex</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^on[A-Z].*\"</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">controls</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token literal-property property\">matchers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(background|color)$</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">Date$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span></code><!-- HTML_TAG_END --></pre>\n<blockquote><p>!Note: the <code>.storybook/main.js</code> file needs to have the alias <code>$styles: path.resolve(&#39;./src/styles&#39;)</code> set in viteâ€™s <code>config.resolve.alias</code> object for the <code>import &#39;$styles/tailwind.css&#39;</code> to work.</p></blockquote>\n<p>Thatâ€™s it! You should have the following correctly set up now:</p>\n<ul><li><em>SvelteKit</em> using <em>TypeScript</em>, styleable with <em>tailwindcss</em>, all using <em>ViteJS</em></li>\n<li>A complementary <em>StorybookJS</em> also using <em>ViteJS</em> and <em>tailwindcss</em> for your <em>TypeScript</em> components.</li></ul>\n<p>Sadly as of now (May 2022) your stories still need to be authored in <em>JavaScript</em>.</p>","css":{"code":"","map":null},"head":"","href":"/notes/sveltekit-storybook-setup/","component":{}}