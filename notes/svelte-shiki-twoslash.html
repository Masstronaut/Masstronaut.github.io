<!doctype html>
<html lang="en" class="min-h-full">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.DCVacgUG.css" rel="stylesheet">
		<link href="../_app/immutable/assets/NoteGridStatusFilter.XVDl0Kvs.css" rel="stylesheet">
		<link href="../_app/immutable/assets/MDSveXNoteLayout.CyYI4j1f.css" rel="stylesheet">
		<link href="../_app/immutable/assets/3.Dsy89llY.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.9HCZTzRe.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CCJ6ibw0.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BrvgqOKF.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BOCtfefK.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CMufJmNh.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.DtSKqsTd.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C1FmrZbK.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BMtht3uS.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DeJ_mBX6.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DhOaGKI3.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CodHM6-c.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Sv_TBA-2.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/tqtBAqyL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DBhMLwmp.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/B8ys1oD7.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CQvACQAz.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.CrrE-OaG.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BmDftNyR.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BaJv1Ckm.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DCbVyqWN.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Xnr4kkBN.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BSczOG1N.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dv2HnFaC.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/HlWhSox1.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C932wzq6.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/3.hbeQjMDk.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DHk5ZHzF.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/OUqcsWVC.js"><!--[--><meta name="description" content="How I transform the code in my markdown files into beautifully rendered snippets on this site." class="svelte-de2ged"> <meta property="og:title" content="Beautifully render code in Svelte" class="svelte-de2ged"> <meta property="og:type" content="article" class="svelte-de2ged"> <meta property="og:url" content="https://allandeutsch.com/notes/svelte-shiki-twoslash" class="svelte-de2ged"> <meta property="og:description" content="How I transform the code in my markdown files into beautifully rendered snippets on this site." class="svelte-de2ged"> <meta property="og:locale" content="en_US" class="svelte-de2ged"> <meta property="twitter:card" content="summary" class="svelte-de2ged"> <meta property="twitter:url" content="https://allandeutsch.com" class="svelte-de2ged"> <meta property="twitter:title" content="Beautifully render code in Svelte" class="svelte-de2ged"> <meta property="twitter:description" content="How I transform the code in my markdown files into beautifully rendered snippets on this site." class="svelte-de2ged"> <meta property="twitter:site" content="@AllanDeutsch" class="svelte-de2ged"> <meta property="twitter:creator" content="@AllanDeutsch" class="svelte-de2ged"> <link rel="canonical" href="https://allandeutsch.com/notes/svelte-shiki-twoslash" class="svelte-de2ged"> <script type="module" src="https://docduck.dev/selection.js" class="svelte-de2ged"></script> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="AllanDeutsch" data-description="Support me on Buy me a coffee!" data-message="" data-color="#5F7FFF" data-position="Right" data-x_margin="18" data-y_margin="18" class="svelte-de2ged"></script><!--]--><!--[--><!--[--><meta name="theme-color" content="dark"><!--]--> <!----><script>(function setInitialMode({ defaultMode = "system", themeColors: themeColors2, darkClassNames: darkClassNames2 = ["dark"], lightClassNames: lightClassNames2 = [], defaultTheme = "", modeStorageKey: modeStorageKey2 = "mode-watcher-mode", themeStorageKey: themeStorageKey2 = "mode-watcher-theme" }) {
  const rootEl = document.documentElement;
  const mode = localStorage.getItem(modeStorageKey2) || defaultMode;
  const theme2 = localStorage.getItem(themeStorageKey2) || defaultTheme;
  const light = mode === "light" || mode === "system" && window.matchMedia("(prefers-color-scheme: light)").matches;
  if (light) {
    if (darkClassNames2.length)
      rootEl.classList.remove(...darkClassNames2);
    if (lightClassNames2.length)
      rootEl.classList.add(...lightClassNames2);
  } else {
    if (lightClassNames2.length)
      rootEl.classList.remove(...lightClassNames2);
    if (darkClassNames2.length)
      rootEl.classList.add(...darkClassNames2);
  }
  rootEl.style.colorScheme = light ? "light" : "dark";
  if (themeColors2) {
    const themeMetaEl = document.querySelector('meta[name="theme-color"]');
    if (themeMetaEl) {
      themeMetaEl.setAttribute("content", mode === "light" ? themeColors2.light : themeColors2.dark);
    }
  }
  if (theme2) {
    rootEl.setAttribute("data-theme", theme2);
    localStorage.setItem(themeStorageKey2, theme2);
  }
  localStorage.setItem(modeStorageKey2, mode);
})({"defaultMode":"system","themeColors":{"dark":"dark","light":"light"},"darkClassNames":["dark"],"lightClassNames":[],"defaultTheme":"","modeStorageKey":"mode-watcher-mode","themeStorageKey":"mode-watcher-theme"});</script><!----><!--]--><title>Beautifully render code in Svelte - Allan Deutsch</title>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script
			async
			src="https://www.googletagmanager.com/gtag/js?id=UA-86124920-1"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());

			gtag('config', 'UA-86124920-1');
		</script>
	</head>
	<body
		data-sveltekit-preload-data="hover"
		data-sveltekit-preload-data="viewport"
		class="h-full min-h-[100vh] bg-base-100">
		<div style="display: contents"><!--[--><!--[--><!----><div class="h-full min-h-[100dvh]"><!--[!--><!--]--><!----> <div class="flex w-full items-center bg-base-100 p-2 print:hidden"><!----><!----><!--[!--><button class="px-4 sm:hidden" id="bits-29" aria-haspopup="menu" aria-expanded="false" data-state="closed" data-dropdown-menu-trigger="" type="button"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16"></path></svg> <span class="sr-only">Open navigation menu</span><!----></button><!--]--><!----><!----> <!----><!----><!--[!--><!--]--><!----><!----><!----><!----><!----><!----> <div class="w-1/2 px-4 text-xl font-semibold"><a href="/">Allan Deutsch</a></div> <div class="hidden shrink-0 sm:flex"><ul class="menu menu-horizontal px-1 text-base"><!--[--><!--[!--><li><a href="/">Home</a></li><!--]--><!--[!--><li><a href="/notes">Notes</a></li><!--]--><!--[!--><li><a href="/devlog">Devlog</a></li><!--]--><!--]--></ul></div> <div class="flex w-1/2 justify-end"><!--[!--><div><a href="https://twitter.com/AllanDeutsch" class="group"><span class="sr-only">Follow me on Twitter</span> <svg height="24" width="24" class="mr-1.5 inline fill-base-content transition-colors duration-300 group-hover:fill-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612"><path d="M612 116.258a250.714 250.714 0 01-72.088 19.772c25.929-15.527 45.777-40.155 55.184-69.411-24.322 14.379-51.169 24.82-79.775 30.48-22.907-24.437-55.49-39.658-91.63-39.658-69.334 0-125.551 56.217-125.551 125.513 0 9.828 1.109 19.427 3.251 28.606-104.326-5.24-196.835-55.223-258.75-131.174-10.823 18.51-16.98 40.078-16.98 63.101 0 43.559 22.181 81.993 55.835 104.479a125.556 125.556 0 01-56.867-15.756v1.568c0 60.806 43.291 111.554 100.693 123.104-10.517 2.83-21.607 4.398-33.08 4.398-8.107 0-15.947-.803-23.634-2.333 15.985 49.907 62.336 86.199 117.253 87.194-42.947 33.654-97.099 53.655-155.916 53.655-10.134 0-20.116-.612-29.944-1.721 55.567 35.681 121.536 56.485 192.438 56.485 230.948 0 357.188-191.291 357.188-357.188l-.421-16.253c24.666-17.593 46.005-39.697 62.794-64.861z"></path></svg></a> <a href="https://github.com/masstronaut" class="group"><span class="sr-only">Follow me on GitHub</span> <svg height="24" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true" class="mr-1.5 inline fill-base-content transition-colors duration-300 group-hover:fill-primary"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a></div><!--]--></div></div><!----> <div class="h-full p-1 sm:p-4"><!----><docduck-feedback team="TKxfdiO22xOXIrW0c0Pfi" class="svelte-de2ged"></docduck-feedback> <div class="grid w-full grid-cols-[1fr_min(65ch,100%)_1fr] svelte-de2ged"><h1 class="col-start-2 col-end-3 text-left text-4xl font-bold svelte-de2ged" style="view-transition-name: title">Beautifully render code in Svelte</h1></div> <article class="note-container prose mb-8 max-w-full px-2 svelte-de2ged" style="view-transition-name: article;"><header class="w-full max-w-3xl self-center svelte-de2ged"><div class="text-md border-t-neutral/20 text-base-content mt-4 mb-12 flex justify-between border-t pt-1 svelte-de2ged"><div class="svelte-de2ged"><span class="pr-2 svelte-de2ged">🌱</span><span class="hidden sm:inline svelte-de2ged">Planted</span>April 7, 2024. <!--[--><br class="svelte-de2ged">Last tended April 24, 2024.<!--]--></div> <div class="flex flex-col items-end svelte-de2ged"><div class="note__status budding svelte-de2ged">budding 🌿</div> <!--[--><div class="svelte-de2ged">5 minutes read ⏱</div><!--]--></div></div></header> <!----><p>I love the craft of building software. It amazes me that I can write something and have computers reliably and consistently do what I told it to. Add a few more clicks and I can make it instantly available to anyone, anywhere on the planet, so long as they have an internet connected device.</p> <p>When I code something particularly interesting I want to share how I did it. Teaching is a valuable part of my own learning process, and it’s rewarding to help other people get excited about building. Sharing code is a critical part of that, and this note is about how I make the code I share look great!</p> <p>To start with, it’s helpful to understand a bit about my pipeline for getting from raw markdown code blocks to a rendered page on <a href="https://allandeutsch.com" rel="nofollow">allandeutsch.com</a>.</p> <ul><li><a href="https://mdsvex.pngwn.io/" rel="nofollow">mdsvex</a> is a svelte preprocessor that uses <a href="https://remark.js.org/" rel="nofollow">remark</a> to process raw markdown and <a href="https://github.com/remarkjs/remark-rehype" rel="nofollow">remark-rehype</a> to transform it to HTML</li> <li>mdsvex passes the markdown code blocks to a code highlighter to provide syntax highlighting</li> <li>A <code>meta</code> string in the code fence of code blocks is used to pass options to twoslash; I use <code>fenceparser</code> to parse the code fence</li> <li>I wrote a highlighter that uses <a href="https://shiki.style" rel="nofollow">shiki</a> to render code in light &amp; dark themes <ul><li>It uses <a href="https://shiki.style/packages/twoslash" rel="nofollow">@shikijs/twoslash</a> to provide type annotations on typescript code</li></ul></li> <li>A CSS media query styles the code using the light or dark theme based on the user’s preference</li></ul> <h2 id="installing-the-dependencies"><a aria-hidden="true" tabindex="-1" href="#installing-the-dependencies"><span class="icon icon-link"></span></a><a href="#installing-the-dependencies" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Installing the dependencies</h2> <p>My site is built using “Static Site Generation” (SSG), a technique which compiles my source into static HTML, CSS, and JS files at build time so the deployment can be delivered to visitors really efficiently via CDN since no logic needs to run on each request. This approach means I can do the highlighting at build time rather than runtime, and all of the tools I listed above can be included as dev dependencies. to install them:</p> <!----><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">npm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --save-dev</span><span style="color:#B56959;--shiki-dark:#C98A7D"> @shikijs/twoslash</span><span style="color:#B56959;--shiki-dark:#C98A7D"> shiki</span><span style="color:#B56959;--shiki-dark:#C98A7D"> mdsvex</span><span style="color:#B56959;--shiki-dark:#C98A7D"> fenceparser</span></span></code></pre><!----><!----><pre class="code-copy-target hidden">npm install --save-dev @shikijs/twoslash shiki mdsvex fenceparser</pre><!----> <h2 id="configuring-mdsvex"><a aria-hidden="true" tabindex="-1" href="#configuring-mdsvex"><span class="icon icon-link"></span></a><a href="#configuring-mdsvex" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Configuring mdsvex</h2> <p>One important thing to know about mdsvex is that it is a svelte <strong>pre</strong>processor. This is important to note: the preprocessor code doesn’t get preprocessed because it runs before the compiler. For now, that means <strong>it cannot use TypeScript</strong> because it would need to be compiled to JS first and that doesn’t happen for <a href="https://github.com/sveltejs/kit/pull/4031" rel="nofollow">reasons</a>. Hopefully that will <a href="https://github.com/sveltejs/rfcs/pull/59" rel="nofollow">change in the future</a>.</p> <p>What this means practically is that the mdsvex config can’t be implemented in TypeScript: it <strong>must</strong> be javascript. Here’s how I configured mine to highlight code blocks!</p> <!----><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0" js filename="mdsvex.config.js"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> defineMDSveXConfig</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#B07D48;--shiki-dark:#BD976A"> defineConfig</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> escapeSvelte</span><span style="color:#999999;--shiki-dark:#666666"> &#125;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">mdsvex</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> codeToHtml</span><span style="color:#999999;--shiki-dark:#666666"> &#125;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">shiki</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> transformerTwoslash</span><span style="color:#999999;--shiki-dark:#666666"> &#125;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">@shikijs/twoslash</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> lex</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> parse</span><span style="color:#999999;--shiki-dark:#666666"> &#125;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">fenceparser</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// Define an mdsvex-compatible code highlighter</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">async</span><span style="color:#AB5959;--shiki-dark:#CB7676"> function</span><span style="color:#59873A;--shiki-dark:#80A665"> ShikiTwoslashHighlighter</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">code</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> lang</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> meta</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">	// Parse the &#96;meta&#96; prop, if defined, for any options to provide to shiki</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">	let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> fence</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">	if</span><span style="color:#999999;--shiki-dark:#666666"> (</span><span style="color:#B07D48;--shiki-dark:#BD976A">meta</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#B07D48;--shiki-dark:#BD976A"> fence</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> parse</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">lex</span><span style="color:#999999;--shiki-dark:#666666">([</span><span style="color:#B07D48;--shiki-dark:#BD976A">lang</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> meta</span><span style="color:#999999;--shiki-dark:#666666">].</span><span style="color:#59873A;--shiki-dark:#80A665">filter</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">Boolean</span><span style="color:#999999;--shiki-dark:#666666">).</span><span style="color:#59873A;--shiki-dark:#80A665">join</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#999999;--shiki-dark:#666666">)));</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">	if</span><span style="color:#999999;--shiki-dark:#666666"> (</span><span style="color:#B07D48;--shiki-dark:#BD976A">fence</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">		// structure the options as a &#96;CodeOptionsMeta&#96; object</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">		fence</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span><span style="color:#999999;--shiki-dark:#666666"> ...</span><span style="color:#B07D48;--shiki-dark:#BD976A">fence</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> __raw</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B07D48;--shiki-dark:#BD976A"> meta</span><span style="color:#999999;--shiki-dark:#666666"> &#125;;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">	&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">	// Run shiki's highlighter</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">	const</span><span style="color:#B07D48;--shiki-dark:#BD976A"> html</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> await</span><span style="color:#59873A;--shiki-dark:#80A665"> codeToHtml</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">code</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">		// shiki's language list is case sensitive and all lowercase</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">		// default behavior without a language is to throw</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">		// I prefer no highlighting, which 'text' achieves</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">		lang</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B07D48;--shiki-dark:#BD976A"> lang</span><span style="color:#AB5959;--shiki-dark:#CB7676"> ?</span><span style="color:#B07D48;--shiki-dark:#BD976A"> lang</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">toLowerCase</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#AB5959;--shiki-dark:#CB7676"> :</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">text</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">		themes</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> light</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">github-light</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> dark</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">slack-dark</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666"> &#125;,</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">		defaultColor</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">light</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">		meta</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B07D48;--shiki-dark:#BD976A"> fence</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">		transformers</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> [</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">			// only run twoslash if &#96;twoslash&#96; is in the code fence</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">			// see: https://shiki.style/packages/twoslash#explicit-trigger</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">			transformerTwoslash</span><span style="color:#999999;--shiki-dark:#666666">(&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> explicitTrigger</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> true</span><span style="color:#999999;--shiki-dark:#666666"> &#125;),</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">			// any other transformers...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">		]</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">	&#125;);</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">	// this escapes the rendered HTML and wraps it in a</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">	// svelte [&#123;@html ...&#125; tag](https://svelte.dev/docs/special-tags#html)</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">	return</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> &#96;</span><span style="color:#B56959;--shiki-dark:#C98A7D">&#123;@html </span><span style="color:#A65E2B;--shiki-dark:#C99076">&#96;</span><span style="color:#1E754F;--shiki-dark:#4D9375">$&#123;</span><span style="color:#59873A;--shiki-dark:#80A665">escapeSvelte</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B56959;--shiki-dark:#C98A7D">html</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#1E754F;--shiki-dark:#4D9375">&#125;</span><span style="color:#A65E2B;--shiki-dark:#C99076">&#96;</span><span style="color:#B56959;--shiki-dark:#C98A7D"> &#125;</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">&#96;</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">&#125;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// configure mdsvex</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">const</span><span style="color:#B07D48;--shiki-dark:#BD976A"> config</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> defineConfig</span><span style="color:#999999;--shiki-dark:#666666">(&#123;</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">	extensions</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> [</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">.md</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">.svx</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">],</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">	highlight</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">		highlighter</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B07D48;--shiki-dark:#BD976A"> ShikiTwoslashHighlighter</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">	&#125;,</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">	// other config options...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">&#125;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">export</span><span style="color:#1E754F;--shiki-dark:#4D9375"> default</span><span style="color:#B07D48;--shiki-dark:#BD976A"> config</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"></span></code></pre><!----><!----><pre class="code-copy-target hidden">import &#123; defineMDSveXConfig as defineConfig, escapeSvelte &#125; from 'mdsvex';
import &#123; codeToHtml &#125; from 'shiki';
import &#123; transformerTwoslash &#125; from '@shikijs/twoslash';
import &#123; lex, parse &#125; from 'fenceparser';

// Define an mdsvex-compatible code highlighter
async function ShikiTwoslashHighlighter(code, lang, meta) &#123;
	// Parse the &#96;meta&#96; prop, if defined, for any options to provide to shiki
	let fence;
	if (meta) fence = parse(lex([lang, meta].filter(Boolean).join(' ')));
	if (fence) &#123;
		// structure the options as a &#96;CodeOptionsMeta&#96; object
		fence = &#123; ...fence, __raw: meta &#125;;
	&#125;

	// Run shiki's highlighter
	const html = await codeToHtml(code, &#123;
		// shiki's language list is case sensitive and all lowercase
		// default behavior without a language is to throw
		// I prefer no highlighting, which 'text' achieves
		lang: lang ? lang.toLowerCase() : 'text',
		themes: &#123; light: 'github-light', dark: 'slack-dark' &#125;,
		defaultColor: 'light',
		meta: fence,
		transformers: [
			// only run twoslash if &#96;twoslash&#96; is in the code fence
			// see: https://shiki.style/packages/twoslash#explicit-trigger
			transformerTwoslash(&#123; explicitTrigger: true &#125;),
			// any other transformers...
		]
	&#125;);
	// this escapes the rendered HTML and wraps it in a
	// svelte [&#123;@html ...&#125; tag](https://svelte.dev/docs/special-tags#html)
	return &#96;&#123;@html &#96;$&#123;escapeSvelte(html)&#125;&#96; &#125;&#96;;
&#125;
// configure mdsvex
const config = defineConfig(&#123;
	extensions: ['.md', '.svx'],
	highlight: &#123;
		highlighter: ShikiTwoslashHighlighter
	&#125;,
	// other config options...
&#125;);

export default config;
</pre><!----> <p>There’s a good bit going on in this config, so I did my best to document it with comments. One aspect I didn’t cover was theming; I think the <a href="https://shiki.style/guide/dual-themes" rel="nofollow">shiki dual theme documentation</a> does a great job explaining how to configure rendering light and dark themes. It also includes CSS snippets for setting the theme. I prefer to follow what the user’s OS specifies, which perfectly fits their <a href="https://shiki.style/guide/dual-themes#query-based-dark-mode" rel="nofollow">CSS media query</a> example which worked for me with no changes.</p> <h2 id="configuring-svelte-to-use-the-mdsvex-preprocessor"><a aria-hidden="true" tabindex="-1" href="#configuring-svelte-to-use-the-mdsvex-preprocessor"><span class="icon icon-link"></span></a><a href="#configuring-svelte-to-use-the-mdsvex-preprocessor" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Configuring svelte to use the mdsvex preprocessor</h2> <p>Svelte needs to be configured to use mdsvex as a preprocessor for markdown files. This is done in <code>svelte.config.js</code>. mdsvex supports using svelte components in markdown. By convention, svelte-y markdown files use the <code>.svx</code> extension, but it’s possible to use any file extension.</p> <p>This is how I configured svelte to use mdsvex as a preprocessor for <code>.md</code> and <code>.svx</code> files:</p> <!----><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0" js filename="svelte.config.js"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> mdsvex</span><span style="color:#999999;--shiki-dark:#666666"> &#125;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">mdsvex</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#B07D48;--shiki-dark:#BD976A"> mdsvexConfig</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">./mdsvex.config.js</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">/** </span><span style="color:#999999;--shiki-dark:#666666">@</span><span style="color:#1E754F;--shiki-dark:#4D9375">type</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">import('@sveltejs/kit').Config</span><span style="color:#999999;--shiki-dark:#666666">&#125;</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> */</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">const</span><span style="color:#B07D48;--shiki-dark:#BD976A"> config</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#999999;--shiki-dark:#666666"> &#123;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">  // using the extensions from mdsvexConfig keeps them in sync</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  extensions</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> [</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">.svelte</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> ...</span><span style="color:#B07D48;--shiki-dark:#BD976A">mdsvexConfig</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">extensions</span><span style="color:#999999;--shiki-dark:#666666">],</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  preprocess</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> [</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">    mdsvex</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">mdsvexConfig</span><span style="color:#999999;--shiki-dark:#666666">),</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> // &#x3C;--- crucial</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    // other preprocessors...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">  ],</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">  // other config...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">&#125;;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">export</span><span style="color:#1E754F;--shiki-dark:#4D9375"> default</span><span style="color:#B07D48;--shiki-dark:#BD976A"> config</span><span style="color:#999999;--shiki-dark:#666666">;</span></span></code></pre><!----><!----><pre class="code-copy-target hidden">import &#123; mdsvex &#125; from 'mdsvex';
import mdsvexConfig from './mdsvex.config.js';

/** @type &#123;import('@sveltejs/kit').Config&#125; */
const config = &#123;
  // using the extensions from mdsvexConfig keeps them in sync
  extensions: ['.svelte', ...mdsvexConfig.extensions],
  preprocess: [
    mdsvex(mdsvexConfig), // &lt;--- crucial
    // other preprocessors...
  ],
  // other config...
&#125;;
export default config;</pre><!----> <p>With that config in place, svelte is able to import <code>.md</code> and <code>.svx</code> files and render them as components.</p> <p>I’ve found this makes my notes on programming (like this one!) much nicer to read. Hopefully you agree!</p><!----><!----> <div class="divider svelte-de2ged"></div> <aside class="prose svelte-de2ged"><p class="svelte-de2ged">If you're feeling extra generous, you can show your support by buying me a
			coffee with the button in the bottom right corner of the page.</p> <div class="divider svelte-de2ged"></div></aside></article> <!----><p class="svelte-de2ged">Loading comments...</p><!---->  <!--[!--><!--]--> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous" class="svelte-de2ged"><!----><!----></div></div> <!--[!--><!--]--><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_1cwbbi4 = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.9HCZTzRe.js"),
						import("../_app/immutable/entry/app.DtSKqsTd.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
